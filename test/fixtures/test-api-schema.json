{
  "swagger": "2.0",
  "info": { "title": "Test API", "version": "1.0" },
  "host": "logic-apis-westus.azure-apim.net",
  "basePath": "/apim/testapi",
  "paths": {
    "/{connectionId}/messages": {
      "get": {
        "operationId": "GetMessages",
        "summary": "Get messages",
        "description": "Retrieve all messages",
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string", "x-ms-visibility": "internal" },
          { "name": "top", "in": "query", "type": "integer", "required": false, "description": "Max items to return", "default": 10 },
          { "name": "filter", "in": "query", "type": "string", "required": false, "description": "OData filter" }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": { "$ref": "#/definitions/MessageList" }
          }
        },
        "x-ms-visibility": "important",
        "x-ms-api-annotation": { "family": "GetMessages", "revision": 1, "status": "Production" }
      },
      "post": {
        "operationId": "SendMessage",
        "summary": "Send a message",
        "description": "Send a new message",
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string", "x-ms-visibility": "internal" },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": { "$ref": "#/definitions/SendMessageRequest" }
          }
        ],
        "responses": {
          "201": {
            "description": "Created",
            "schema": { "$ref": "#/definitions/Message" }
          }
        },
        "x-ms-visibility": "important",
        "x-ms-api-annotation": { "family": "SendMessage", "revision": 2, "status": "Production" }
      }
    },
    "/{connectionId}/messages/{messageId}": {
      "get": {
        "operationId": "GetMessage",
        "summary": "Get a message",
        "description": "Get a specific message by ID",
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string", "x-ms-visibility": "internal" },
          { "name": "messageId", "in": "path", "required": true, "type": "string", "description": "Message ID" }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": { "$ref": "#/definitions/Message" }
          }
        }
      },
      "delete": {
        "operationId": "DeleteMessage",
        "summary": "Delete a message",
        "description": "Delete a specific message",
        "deprecated": true,
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string", "x-ms-visibility": "internal" },
          { "name": "messageId", "in": "path", "required": true, "type": "string", "description": "Message ID" }
        ],
        "responses": { "204": { "description": "No Content" } },
        "x-ms-api-annotation": { "family": "DeleteMessage", "revision": 1, "status": "Production" }
      }
    },
    "/{connectionId}/messages/{messageId}/v2": {
      "delete": {
        "operationId": "DeleteMessageV2",
        "summary": "Delete a message (v2)",
        "description": "Delete a specific message (v2)",
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string", "x-ms-visibility": "internal" },
          { "name": "messageId", "in": "path", "required": true, "type": "string", "description": "Message ID" }
        ],
        "responses": { "204": { "description": "No Content" } },
        "x-ms-api-annotation": { "family": "DeleteMessage", "revision": 2, "status": "Production" }
      }
    },
    "/{connectionId}/internal/metadata": {
      "get": {
        "operationId": "GetMetadata",
        "summary": "Get metadata",
        "description": "Internal metadata endpoint",
        "x-ms-visibility": "internal",
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string" }
        ],
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/{connectionId}/triggers/onNewMessage": {
      "get": {
        "operationId": "OnNewMessage",
        "summary": "When a new message arrives",
        "description": "Trigger when a new message arrives",
        "x-ms-trigger": "batch",
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string" }
        ],
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/{connectionId}/$subscriptions": {
      "post": {
        "operationId": "CreateSubscription",
        "summary": "Create subscription",
        "description": "Create a webhook subscription",
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string" }
        ],
        "responses": { "201": { "description": "Created" } }
      }
    },
    "/{connectionId}/contacts": {
      "get": {
        "operationId": "GetContacts",
        "summary": "Get contacts",
        "description": "Get all contacts",
        "x-ms-visibility": "advanced",
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string", "x-ms-visibility": "internal" },
          { "name": "status", "in": "query", "type": "string", "enum": ["active", "inactive", "all"], "required": false, "description": "Filter by status" }
        ],
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/{connectionId}/files": {
      "post": {
        "operationId": "UploadFile",
        "summary": "Upload a file",
        "description": "Upload a file attachment",
        "parameters": [
          { "name": "connectionId", "in": "path", "required": true, "type": "string", "x-ms-visibility": "internal" },
          { "name": "fileName", "in": "query", "type": "string", "required": true, "description": "File name" },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": { "$ref": "#/definitions/FileUpload" }
          }
        ],
        "responses": { "200": { "description": "OK" } }
      }
    }
  },
  "definitions": {
    "MessageList": {
      "type": "object",
      "properties": {
        "value": {
          "type": "array",
          "items": { "$ref": "#/definitions/Message" }
        }
      }
    },
    "Message": {
      "type": "object",
      "properties": {
        "id": { "type": "string", "description": "Message ID" },
        "subject": { "type": "string", "description": "Subject", "x-ms-summary": "Subject" },
        "body": { "type": "string", "description": "Body content" },
        "from": { "type": "string", "description": "Sender" },
        "isRead": { "type": "boolean", "description": "Read status" }
      }
    },
    "SendMessageRequest": {
      "type": "object",
      "required": ["to", "subject"],
      "properties": {
        "to": { "type": "string", "description": "Recipient email", "x-ms-summary": "To" },
        "subject": { "type": "string", "description": "Email subject", "x-ms-summary": "Subject" },
        "body": { "type": "string", "description": "Email body", "x-ms-summary": "Body" },
        "importance": { "type": "string", "enum": ["Low", "Normal", "High"], "description": "Importance level", "default": "Normal" },
        "attachments": {
          "type": "array",
          "items": { "$ref": "#/definitions/Attachment" },
          "description": "File attachments"
        },
        "options": {
          "$ref": "#/definitions/SendOptions",
          "description": "Send options"
        }
      }
    },
    "Attachment": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "contentBytes": { "type": "string", "format": "binary" }
      }
    },
    "SendOptions": {
      "type": "object",
      "properties": {
        "saveToSentItems": { "type": "boolean", "default": true, "description": "Save to sent items" },
        "readReceipt": { "type": "boolean", "description": "Request read receipt" }
      }
    },
    "FileUpload": {
      "type": "object",
      "required": ["content"],
      "properties": {
        "content": { "type": "string", "format": "binary", "description": "File content" },
        "contentType": { "type": "string", "description": "MIME type" }
      }
    }
  }
}
